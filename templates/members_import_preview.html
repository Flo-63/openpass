{% extends "base.html" %}
{% block title %}CSV-Vorschau{% endblock %}

{% block content %}
<div id="import-preview">
  <h2>CSV-Vorschau</h2>

<form id="import-form"
      method="post"
      hx-post="/members/import-commit"
      hx-target="#import-preview"
      hx-swap="outerHTML">
<input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

    <table class="table-auto w-full border mt-4 text-sm">
      <thead class="bg-gray-50">
        <tr>
          <th>#</th>
          <th>Vorname</th>
          <th>Nachname</th>
          <th>E-Mail</th>
          <th>Eintritt</th>
          <th>Rolle</th>
          <th>Fehler</th>
        </tr>
      </thead>
      <tbody>
        {% for row in rows %}
        <tr class="{% if row._errors %}bg-red-100{% else %}hover:bg-green-50{% endif %}">
          <td>{{ row.rownum }}</td>
          <td><input name="rows[{{ loop.index0 }}][firstname]" value="{{ row.firstname }}" class="border px-2 py-1 w-full"></td>
          <td><input name="rows[{{ loop.index0 }}][lastname]" value="{{ row.lastname }}" class="border px-2 py-1 w-full"></td>
          <td><input name="rows[{{ loop.index0 }}][email]" value="{{ row.email }}" class="border px-2 py-1 w-full"></td>
          <td><input name="rows[{{ loop.index0 }}][joindate]" value="{{ row.joindate }}" class="border px-2 py-1 w-full"></td>
          <td><input name="rows[{{ loop.index0 }}][role]" value="{{ row.role }}" class="border px-2 py-1 w-full"></td>
          <td>
            {% if row._errors %}
              <ul class="text-red-600 list-disc list-inside">
                {% for e in row._errors %}
                  <li>{{ e }}</li>
                {% endfor %}
              </ul>
            {% else %}
              ‚úÖ
            {% endif %}
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>

    <div class="mt-4 flex gap-4">
      <button type="submit" class="button">üíæ Import speichern</button>

      <button type="button"
              hx-post="/members/import-revalidate"
              hx-target="#import-preview"
              hx-include="#import-form"
              hx-swap="outerHTML"
              class="button">
        üîÅ Erneut pr√ºfen
      </button>
    </div>
  </form>
</div>
{% endblock %}
